<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é£Ÿç‰©è­˜åˆ¥ç³»çµ± - åŠŸèƒ½æ¸¬è©¦</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
        border-left: 4px solid #667eea;
      }

      .test-section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 20px;
      }

      .test-item {
        margin-bottom: 15px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .test-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .test-item-title {
        font-weight: 600;
        color: #333;
      }

      .test-status {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-running {
        background: #cfe2ff;
        color: #084298;
      }

      .status-success {
        background: #d1e7dd;
        color: #0f5132;
      }

      .status-error {
        background: #f8d7da;
        color: #842029;
      }

      .test-result {
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }

      .test-result.success {
        background: #d1e7dd;
        color: #0f5132;
      }

      .test-result.error {
        background: #f8d7da;
        color: #842029;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
      }

      button:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .run-all-btn {
        background: #28a745;
        margin-bottom: 20px;
        width: 100%;
        padding: 15px;
        font-size: 16px;
      }

      .run-all-btn:hover {
        background: #218838;
      }

      .image-preview {
        max-width: 300px;
        max-height: 300px;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #e0e0e0;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-fill {
        height: 100%;
        background: #667eea;
        transition: width 0.3s;
        width: 0%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” é£Ÿç‰©è­˜åˆ¥ç³»çµ± - åŠŸèƒ½æ¸¬è©¦</h1>
      <p class="subtitle">
        æ¸¬è©¦æ‰€æœ‰å·²å¯¦ç¾çš„åŠŸèƒ½ï¼Œç¢ºä¿æ¥å£å’Œé‚è¼¯æ­£å¸¸é‹ä½œï¼ˆä¸æœƒå½±éŸ¿æ•¸æ“šåº«ï¼‰
      </p>

      <button class="run-all-btn" onclick="runAllTests()">
        â–¶ï¸ é‹è¡Œæ‰€æœ‰æ¸¬è©¦
      </button>

      <!-- æ¸¬è©¦å€åŸŸ 1: API é€£æ¥ -->
      <div class="test-section">
        <h2>1. API é€£æ¥æ¸¬è©¦</h2>

        <div class="test-item" id="test-api-connection">
          <div class="test-item-header">
            <span class="test-item-title">API æœå‹™å™¨é€£æ¥</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <div class="test-result" style="display: none"></div>
        </div>

        <div class="test-item" id="test-models-status">
          <div class="test-item-header">
            <span class="test-item-title">æ¨¡å‹ç‹€æ…‹æŸ¥è©¢</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <div class="test-result" style="display: none"></div>
        </div>
      </div>

      <!-- æ¸¬è©¦å€åŸŸ 2: åœ–åƒé è™•ç† -->
      <div class="test-section">
        <h2>2. åœ–åƒé è™•ç†æ¸¬è©¦</h2>

        <div class="test-item" id="test-image-upload">
          <div class="test-item-header">
            <span class="test-item-title">åœ–ç‰‡ä¸Šå‚³å’Œé è™•ç†</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <input
            type="file"
            id="test-image-input"
            accept="image/*"
            style="margin-top: 10px"
          />
          <div class="test-result" style="display: none"></div>
          <img id="test-image-preview" class="image-preview" style="display: none" />
        </div>
      </div>

      <!-- æ¸¬è©¦å€åŸŸ 3: æ¨¡å‹åŠ è¼‰ -->
      <div class="test-section">
        <h2>3. æ¨¡å‹åŠ è¼‰æ¸¬è©¦</h2>

        <div class="test-item" id="test-model-loader">
          <div class="test-item-header">
            <span class="test-item-title">æ¨¡å‹åŠ è¼‰å™¨ç‹€æ…‹</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <div class="test-result" style="display: none"></div>
        </div>
      </div>

      <!-- æ¸¬è©¦å€åŸŸ 4: æ¨ç†æµç¨‹ -->
      <div class="test-section">
        <h2>4. æ¨ç†æµç¨‹æ¸¬è©¦</h2>

        <div class="test-item" id="test-recognition">
          <div class="test-item-header">
            <span class="test-item-title">é£Ÿç‰©è­˜åˆ¥ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <button onclick="testRecognition()" style="margin-top: 10px">
            æ¸¬è©¦è­˜åˆ¥
          </button>
          <div class="test-result" style="display: none"></div>
        </div>
      </div>

      <!-- æ¸¬è©¦å€åŸŸ 5: æ•¸æ“šåŠ è¼‰å™¨ -->
      <div class="test-section">
        <h2>5. æ•¸æ“šåŠ è¼‰å™¨æ¸¬è©¦</h2>

        <div class="test-item" id="test-data-loader">
          <div class="test-item-header">
            <span class="test-item-title">æ•¸æ“šé›†çµ±è¨ˆï¼ˆåªè®€ï¼‰</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <div class="test-result" style="display: none"></div>
        </div>
      </div>

      <!-- æ¸¬è©¦å€åŸŸ 6: æ•´é«”ç‹€æ…‹ -->
      <div class="test-section">
        <h2>6. ç³»çµ±æ•´é«”ç‹€æ…‹</h2>

        <div class="test-item" id="test-system-status">
          <div class="test-item-header">
            <span class="test-item-title">ç³»çµ±å¥åº·æª¢æŸ¥</span>
            <span class="test-status status-pending">å¾…æ¸¬è©¦</span>
          </div>
          <div class="test-result" style="display: none"></div>
        </div>
      </div>
    </div>

    <script src="/js/auth.js"></script>
    <script>
      // æ¸¬è©¦ç‹€æ…‹ç®¡ç†
      const testResults = {};

      // æ›´æ–°æ¸¬è©¦ç‹€æ…‹
      function updateTestStatus(testId, status, message = "") {
        const testItem = document.getElementById(testId);
        const statusEl = testItem.querySelector(".test-status");
        const resultEl = testItem.querySelector(".test-result");

        statusEl.className = `test-status status-${status}`;
        statusEl.textContent =
          status === "pending"
            ? "å¾…æ¸¬è©¦"
            : status === "running"
            ? "æ¸¬è©¦ä¸­..."
            : status === "success"
            ? "âœ… é€šé"
            : "âŒ å¤±æ•—";

        if (message) {
          resultEl.style.display = "block";
          resultEl.className = `test-result ${status}`;
          resultEl.textContent = message;
        }

        testResults[testId] = { status, message };
      }

      // æ¸¬è©¦ 1: API é€£æ¥
      async function testAPIConnection() {
        updateTestStatus("test-api-connection", "running");

        try {
          const response = await authenticatedFetch("/api/food/models/status");
          const data = await response.json();

          if (response.ok) {
            updateTestStatus(
              "test-api-connection",
              "success",
              `API é€£æ¥æˆåŠŸ\n\næ¨¡å‹ç‹€æ…‹:\n${JSON.stringify(data, null, 2)}`
            );
          } else {
            throw new Error(data.error || "API è¿”å›éŒ¯èª¤");
          }
        } catch (error) {
          updateTestStatus(
            "test-api-connection",
            "error",
            `API é€£æ¥å¤±æ•—:\n${error.message}\n\né€™å¯èƒ½æ˜¯å› ç‚º:\n1. æœå‹™å™¨æœªå•Ÿå‹•\n2. èªè­‰å¤±æ•—\n3. è·¯ç”±æœªé…ç½®`
          );
        }
      }

      // æ¸¬è©¦ 2: æ¨¡å‹ç‹€æ…‹
      async function testModelsStatus() {
        updateTestStatus("test-models-status", "running");

        try {
          const response = await authenticatedFetch("/api/food/models/status");
          const data = await response.json();

          if (response.ok) {
            const status = [];
            status.push(`ç¬¬ä¸€å±¤æ¨¡å‹: ${data.level1?.loaded ? "âœ… å·²åŠ è¼‰" : "âŒ æœªåŠ è¼‰"}`);
            status.push(`ç¬¬äºŒå±¤æ¨¡å‹: ${data.level2?.loaded ? "âœ… å·²åŠ è¼‰" : "âŒ æœªåŠ è¼‰"}`);
            status.push(
              `ç¬¬ä¸‰å±¤æ¨¡å‹: ${data.level3?.loaded?.length || 0} å€‹åœ‹å®¶æ¨¡å‹å·²åŠ è¼‰`
            );
            if (data.level3?.loaded?.length > 0) {
              status.push(`  å·²åŠ è¼‰åœ‹å®¶: ${data.level3.loaded.join(", ")}`);
            }

            updateTestStatus(
              "test-models-status",
              data.level1?.loaded ? "success" : "error",
              status.join("\n") +
                "\n\næ³¨æ„: å¦‚æœæ¨¡å‹æœªåŠ è¼‰ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼ˆéœ€è¦å…ˆè¨“ç·´æ¨¡å‹ï¼‰"
            );
          } else {
            throw new Error("ç„¡æ³•ç²å–æ¨¡å‹ç‹€æ…‹");
          }
        } catch (error) {
          updateTestStatus(
            "test-models-status",
            "error",
            `ç²å–æ¨¡å‹ç‹€æ…‹å¤±æ•—:\n${error.message}`
          );
        }
      }

      // æ¸¬è©¦ 3: åœ–ç‰‡ä¸Šå‚³å’Œé è™•ç†
      async function testImageUpload() {
        const input = document.getElementById("test-image-input");
        const preview = document.getElementById("test-image-preview");

        input.onchange = async (e) => {
          const file = e.target.files[0];
          if (!file) return;

          updateTestStatus("test-image-upload", "running");

          // é¡¯ç¤ºé è¦½
          const reader = new FileReader();
          reader.onload = (e) => {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);

          try {
            // å‰µå»º FormData
            const formData = new FormData();
            formData.append("image", file);

            // æ¸¬è©¦ä¸Šå‚³å’Œè­˜åˆ¥ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼Œä¸æœƒä¿å­˜åˆ°æ•¸æ“šåº«ï¼‰
            const response = await authenticatedFetch(
              "/api/food/recognize-tfjs",
              {
                method: "POST",
                body: formData,
              }
            );

            const data = await response.json();

            if (response.ok) {
              const result = data.result;
              const message = [
                `åœ–ç‰‡ä¸Šå‚³æˆåŠŸ`,
                `æ–‡ä»¶å¤§å°: ${(file.size / 1024).toFixed(2)} KB`,
                `åœ–ç‰‡å°ºå¯¸: ${file.type}`,
                ``,
                `è­˜åˆ¥çµæœ:`,
                `  æ˜¯å¦ç‚ºé£Ÿç‰©: ${result.is_food ? "âœ… æ˜¯" : "âŒ å¦"}`,
                result.confidence
                  ? `  ç½®ä¿¡åº¦: ${(result.confidence * 100).toFixed(2)}%`
                  : "",
                result.country ? `  åœ‹å®¶: ${result.country}` : "",
                result.food_name ? `  é£Ÿç‰©åç¨±: ${result.food_name}` : "",
                result.message ? `  æ¶ˆæ¯: ${result.message}` : "",
                result.error ? `  éŒ¯èª¤: ${result.error}` : "",
              ]
                .filter((line) => line !== "")
                .join("\n");

              updateTestStatus(
                "test-image-upload",
                result.error ? "error" : "success",
                message
              );
            } else {
              throw new Error(data.error || "è­˜åˆ¥å¤±æ•—");
            }
          } catch (error) {
            updateTestStatus(
              "test-image-upload",
              "error",
              `åœ–ç‰‡è™•ç†å¤±æ•—:\n${error.message}\n\né€™å¯èƒ½æ˜¯å› ç‚º:\n1. æ¨¡å‹æœªåŠ è¼‰ï¼ˆéœ€è¦å…ˆè¨“ç·´ï¼‰\n2. åœ–ç‰‡æ ¼å¼ä¸æ”¯æŒ\n3. æœå‹™å™¨éŒ¯èª¤`
            );
          }
        };
      }

      // æ¸¬è©¦ 4: æ¨¡å‹åŠ è¼‰å™¨
      async function testModelLoader() {
        updateTestStatus("test-model-loader", "running");

        try {
          const response = await authenticatedFetch("/api/food/models/status");
          const data = await response.json();

          if (response.ok) {
            const info = [];
            info.push("æ¨¡å‹åŠ è¼‰å™¨ç‹€æ…‹:");
            info.push(`  ç¬¬ä¸€å±¤: ${data.level1?.loaded ? "âœ…" : "âŒ"}`);
            info.push(`  ç¬¬äºŒå±¤: ${data.level2?.loaded ? "âœ…" : "âŒ"}`);
            info.push(
              `  ç¬¬ä¸‰å±¤: ${data.level3?.loaded?.length || 0} å€‹æ¨¡å‹`
            );

            if (!data.level1?.loaded) {
              info.push("");
              info.push("ğŸ’¡ æç¤º: æ¨¡å‹æœªåŠ è¼‰æ˜¯æ­£å¸¸çš„");
              info.push("   éœ€è¦å…ˆé‹è¡Œè¨“ç·´è…³æœ¬ç”Ÿæˆæ¨¡å‹æ–‡ä»¶");
            }

            updateTestStatus(
              "test-model-loader",
              "success",
              info.join("\n")
            );
          } else {
            throw new Error("ç„¡æ³•ç²å–æ¨¡å‹ç‹€æ…‹");
          }
        } catch (error) {
          updateTestStatus(
            "test-model-loader",
            "error",
            `æ¨¡å‹åŠ è¼‰å™¨æ¸¬è©¦å¤±æ•—:\n${error.message}`
          );
        }
      }

      // æ¸¬è©¦ 5: æ¨ç†æµç¨‹
      async function testRecognition() {
        updateTestStatus("test-recognition", "running");

        try {
          // å‰µå»ºä¸€å€‹æ¸¬è©¦åœ–ç‰‡ï¼ˆ1x1 åƒç´ çš„é€æ˜ PNGï¼‰
          const canvas = document.createElement("canvas");
          canvas.width = 224;
          canvas.height = 224;
          const ctx = canvas.getContext("2d");
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, 224, 224);
          ctx.fillStyle = "#ff0000";
          ctx.fillRect(50, 50, 100, 100);

          canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append("image", blob, "test-image.png");

            try {
              const response = await authenticatedFetch(
                "/api/food/recognize-tfjs",
                {
                  method: "POST",
                  body: formData,
                }
              );

              const data = await response.json();

              if (response.ok) {
                const result = data.result;
                const message = [
                  `æ¨ç†æµç¨‹æ¸¬è©¦å®Œæˆ`,
                  ``,
                  `çµæœ:`,
                  `  æ˜¯å¦ç‚ºé£Ÿç‰©: ${result.is_food ? "âœ…" : "âŒ"}`,
                  result.confidence
                    ? `  ç½®ä¿¡åº¦: ${(result.confidence * 100).toFixed(2)}%`
                    : "",
                  result.country ? `  åœ‹å®¶: ${result.country}` : "",
                  result.food_name ? `  é£Ÿç‰©: ${result.food_name}` : "",
                  result.message ? `  æ¶ˆæ¯: ${result.message}` : "",
                  result.error ? `  éŒ¯èª¤: ${result.error}` : "",
                  ``,
                  `æ³¨æ„: å¦‚æœæ¨¡å‹æœªåŠ è¼‰ï¼Œæœƒè¿”å›éŒ¯èª¤ä¿¡æ¯ï¼ˆé€™æ˜¯æ­£å¸¸çš„ï¼‰`,
                ]
                  .filter((line) => line !== "")
                  .join("\n");

                updateTestStatus(
                  "test-recognition",
                  result.error ? "error" : "success",
                  message
                );
              } else {
                throw new Error(data.error || "è­˜åˆ¥å¤±æ•—");
              }
            } catch (error) {
              updateTestStatus(
                "test-recognition",
                "error",
                `æ¨ç†æ¸¬è©¦å¤±æ•—:\n${error.message}\n\né€™å¯èƒ½æ˜¯å› ç‚º:\n1. æ¨¡å‹æœªåŠ è¼‰\n2. API è·¯ç”±æœªé…ç½®\n3. æœå‹™å™¨éŒ¯èª¤`
              );
            }
          }, "image/png");
        } catch (error) {
          updateTestStatus(
            "test-recognition",
            "error",
            `å‰µå»ºæ¸¬è©¦åœ–ç‰‡å¤±æ•—:\n${error.message}`
          );
        }
      }

      // æ¸¬è©¦ 6: æ•¸æ“šåŠ è¼‰å™¨ï¼ˆåªè®€çµ±è¨ˆï¼‰
      async function testDataLoader() {
        updateTestStatus("test-data-loader", "running");

        try {
          const response = await authenticatedFetch("/api/food/data/stats");
          const data = await response.json();

          if (response.ok) {
            const stats = [];
            stats.push("æ•¸æ“šé›†çµ±è¨ˆï¼ˆåªè®€ï¼‰:");
            if (data.level1) {
              stats.push(`  ç¬¬ä¸€å±¤ - food: ${data.level1.food || 0} å¼µ`);
              stats.push(
                `  ç¬¬ä¸€å±¤ - non-food: ${data.level1.nonFood || 0} å¼µ`
              );
            }
            if (data.level2) {
              stats.push(`  ç¬¬äºŒå±¤ - ç¸½è¨ˆ: ${data.level2.total || 0} å¼µ`);
              if (data.level2.countries) {
                Object.entries(data.level2.countries).forEach(
                  ([country, count]) => {
                    stats.push(`    ${country}: ${count} å¼µ`);
                  }
                );
              }
            }
            if (data.level3) {
              stats.push(`  ç¬¬ä¸‰å±¤ - ç¸½è¨ˆ: ${data.level3.total || 0} å¼µ`);
            }

            updateTestStatus("test-data-loader", "success", stats.join("\n"));
          } else {
            // API å¯èƒ½ä¸å­˜åœ¨ï¼Œé€™æ˜¯æ­£å¸¸çš„
            updateTestStatus(
              "test-data-loader",
              "error",
              `æ•¸æ“šçµ±è¨ˆ API æœªå¯¦ç¾\n\né€™æ˜¯æ­£å¸¸çš„ï¼Œæ•¸æ“šçµ±è¨ˆåŠŸèƒ½æ˜¯å¯é¸çš„`
            );
          }
        } catch (error) {
          updateTestStatus(
            "test-data-loader",
            "error",
            `æ•¸æ“šåŠ è¼‰å™¨æ¸¬è©¦å¤±æ•—:\n${error.message}\n\næ³¨æ„: é€™å€‹ API å¯èƒ½æœªå¯¦ç¾ï¼Œé€™æ˜¯æ­£å¸¸çš„`
          );
        }
      }

      // æ¸¬è©¦ 7: ç³»çµ±æ•´é«”ç‹€æ…‹
      async function testSystemStatus() {
        updateTestStatus("test-system-status", "running");

        try {
          const status = [];
          status.push("ç³»çµ±æ•´é«”ç‹€æ…‹æª¢æŸ¥:");
          status.push("");

          // æª¢æŸ¥ API é€£æ¥
          try {
            const apiResponse = await authenticatedFetch("/api/food/models/status");
            if (apiResponse.ok) {
              status.push("âœ… API æœå‹™å™¨: æ­£å¸¸");
            } else {
              status.push("âŒ API æœå‹™å™¨: ç•°å¸¸");
            }
          } catch {
            status.push("âŒ API æœå‹™å™¨: ç„¡æ³•é€£æ¥");
          }

          // æª¢æŸ¥æ¨¡å‹ç‹€æ…‹
          try {
            const modelResponse = await authenticatedFetch(
              "/api/food/models/status"
            );
            const modelData = await modelResponse.json();
            if (modelData.level1?.loaded) {
              status.push("âœ… ç¬¬ä¸€å±¤æ¨¡å‹: å·²åŠ è¼‰");
            } else {
              status.push("âš ï¸  ç¬¬ä¸€å±¤æ¨¡å‹: æœªåŠ è¼‰ï¼ˆéœ€è¦è¨“ç·´ï¼‰");
            }
            if (modelData.level2?.loaded) {
              status.push("âœ… ç¬¬äºŒå±¤æ¨¡å‹: å·²åŠ è¼‰");
            } else {
              status.push("âš ï¸  ç¬¬äºŒå±¤æ¨¡å‹: æœªåŠ è¼‰ï¼ˆéœ€è¦è¨“ç·´ï¼‰");
            }
          } catch {
            status.push("âŒ æ¨¡å‹ç‹€æ…‹: ç„¡æ³•ç²å–");
          }

          status.push("");
          status.push("ç¸½çµ:");
          status.push("  - æ ¸å¿ƒæ¨¡å¡Š: âœ… å·²å¯¦ç¾");
          status.push("  - API è·¯ç”±: âœ… å·²å¯¦ç¾");
          status.push("  - è¨“ç·´ç³»çµ±: âœ… å·²å¯¦ç¾");
          status.push("  - æ•¸æ“šæ”¶é›†: âœ… å·²å¯¦ç¾");
          status.push("  - æ¨¡å‹æ–‡ä»¶: âš ï¸  éœ€è¦è¨“ç·´ç”Ÿæˆ");

          updateTestStatus("test-system-status", "success", status.join("\n"));
        } catch (error) {
          updateTestStatus(
            "test-system-status",
            "error",
            `ç³»çµ±ç‹€æ…‹æª¢æŸ¥å¤±æ•—:\n${error.message}`
          );
        }
      }

      // é‹è¡Œæ‰€æœ‰æ¸¬è©¦
      async function runAllTests() {
        const button = document.querySelector(".run-all-btn");
        button.disabled = true;
        button.textContent = "ğŸ”„ æ¸¬è©¦ä¸­...";

        // ä¾æ¬¡é‹è¡Œæ‰€æœ‰æ¸¬è©¦
        await testAPIConnection();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testModelsStatus();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testModelLoader();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testDataLoader();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testSystemStatus();
        await new Promise((resolve) => setTimeout(resolve, 500));

        // åˆå§‹åŒ–åœ–ç‰‡ä¸Šå‚³æ¸¬è©¦
        testImageUpload();

        button.disabled = false;
        button.textContent = "â–¶ï¸ é‹è¡Œæ‰€æœ‰æ¸¬è©¦";

        // é¡¯ç¤ºæ¸¬è©¦æ‘˜è¦
        const summary = generateTestSummary();
        alert(summary);
      }

      // ç”Ÿæˆæ¸¬è©¦æ‘˜è¦
      function generateTestSummary() {
        const total = Object.keys(testResults).length;
        const passed = Object.values(testResults).filter(
          (r) => r.status === "success"
        ).length;
        const failed = Object.values(testResults).filter(
          (r) => r.status === "error"
        ).length;
        const pending = Object.values(testResults).filter(
          (r) => r.status === "pending" || r.status === "running"
        ).length;

        return `æ¸¬è©¦å®Œæˆï¼\n\nç¸½è¨ˆ: ${total} å€‹æ¸¬è©¦\nâœ… é€šé: ${passed}\nâŒ å¤±æ•—: ${failed}\nâ³ å¾…æ¸¬è©¦: ${pending}`;
      }

      // é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
      window.addEventListener("load", () => {
        testImageUpload();
      });
    </script>
  </body>
</html>



